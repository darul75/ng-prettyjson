/** 
* @license ng-twitter - v0.0.1
* (c) 2013 Julien VALERY https://github.com/darul75/ng-twitter
* License: MIT 
**/
!function(a){"use strict";a.module("ngTwitter",["ngSanitize"]).service("linkify",function(){function b(b){return a.element("<div/>").text(b).html()}return{linkify_entities:function(c){if(!c.entities)return b(c.text);var d={};a.forEach(c.entities.urls,function(a){d[a.indices[0]]=[a.indices[1],function(){return"<a href='"+b(a.url)+"' class='link' target='_blank'>"+b(a.display_url)+"</a>"}]}),a.forEach(c.entities.hashtags,function(a){d[a.indices[0]]=[a.indices[1],function(c){return"<a href='http://twitter.com/search?q=%23"+b(a.text)+"' class='hash' target='_blank'>"+b(c)+"</a>"}]}),a.forEach(c.entities.user_mentions,function(a){d[a.indices[0]]=[a.indices[1],function(c){return"<a title='"+b(a.name)+"' href='http://twitter.com/"+b(a.screen_name)+"' class='mention' target='_blank'>"+b(c)+"</a>"}]});var e="",f=0,g=0;for(g=0;g<c.text.length;++g){var h=d[g];if(h){var i=h[0],j=h[1];g>f&&(e+=b(c.text.substring(f,g))),e+=j(c.text.substring(g,i)),g=i-1,f=i}}return g>f&&(e+=b(c.text.substring(f,g))),e}}}).service("twitter",["$http",function(a){return{asyncAuthCall:function(b){var c={headers:{Authorization:"Basic "+b,"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"},withCredentials:!0},d=a.post("https://api.twitter.com/oauth2/token","grant_type=client_credentials",c).then(function(a){return a});return d},asyncSearchCall:function(b,c,d){var e={headers:{Authorization:"Bearer "+b,"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"}},f=d?"&since_id="+d:"",g="https://api.twitter.com/1.1/search/tweets.json?q=%23"+c+f,h=a.get(g,e).then(function(a){return a});return h}}}]).directive("tweets",["$timeout","twitter","linkify",function(a,b,c){return{restrict:"AE",scope:{key:"=",hashtag:"=",refresh:"@",button:"@",hash:"@",count:"@"},template:'<div class="panel" ng-show="button"><button name="start" ng-click="startTimeout()" ng-show="stop">start</button><button name="stop" ng-click="stopTimeout()" ng-show="!stop">stop</button> Refreshing in {{counter}}</div><div class="panel" ng-show="hash"><input type="text" name="input" ng-model="hashtag"></div><ul class="tweetFavList"><li ng-repeat="tweet in tweets"><p ng-bind-html="prettyDisplay(tweet)"><p><div class="info"><a title="Go to twitter page" class="user" href="http://twitter.com/{{tweet.user.screen_name}}" target="_blank">{{tweet.user.screen_name}}</a><span title="Retweet Count" class="retweet">{{tweet.retweet_count}}</span></div></li></ul>',link:function(d){var e,f,g=b,h=!1,i=d.refresh?d.refresh:60,j=d.count?d.count:void 0;if(d.counter=i,d.stop=!1,d.tweets=[],d.key){d.init=function(){g.asyncAuthCall(d.key).then(function(a){f=a.data.access_token,d.$watch("hashtag",function(a,b){if(a!==b||!h){if(!f)return;d.search()}}),h=!0,d.search()})},d.onTimeout=function(){d.search(),k=a(d.onTimeout,1e3*i)},d.onTimeoutCounter=function(){d.counter--,l=a(d.onTimeoutCounter,1e3)};var k=a(d.onTimeout,1e3*i),l=a(d.onTimeoutCounter,1e3);d.stopTimeout=function(){d.counter=i,d.stop=!0,a.cancel(k),a.cancel(l)},d.startTimeout=function(){d.stop=!1,k=a(d.onTimeout,1e3*i),l=a(d.onTimeoutCounter,1e3)},d.search=function(){g.asyncSearchCall(f,d.hashtag,e).then(function(a){return d.counter=i,a.data.errors?(console.log(a.data.errors[0]),void 0):(a&&a.data&&a.data.statuses&&(d.tweets=a.data.statuses,j&&(d.tweets=d.tweets.slice(0,j)),e=a.data.search_metadata.since_id),void 0)})},d.prettyDisplay=function(a){return c.linkify_entities(a)},d.init()}}}}])}(angular);